@Library('pipeline-library')_


pipeline {

  agent any

    triggers {
        cron('H H/1 * * 1-5')
    }

  environment {
    ERASE_PLATFORM_STEP = true
    PLATFORM_HOME = 'hybris/bin/platform'
    BINARIES_HOME = 'hybris/bin/'
    HYBRIS_HOME = 'hybris/'
    HYBRIS_ZIP = '../../../../binaries/hybris64.zip'
  }

  stages {
    stage('Erase Platform') {
      steps {

        when {
          beforeAgent true
          environment name: 'ERASE_PLATFORM_STEP', value: 'true'
        }

        echo "Branch: ${env.BRANCH_NAME} "
          
        erasePlatform env.BINARIES_HOME
        unzipPlatform env.BINARIES_HOME,env.HYBRIS_ZIP
      }
    }
    stage('Build') {
      steps {

        antBuilds env.PLATFORM_HOME, env.HYBRIS_HOME

        notifySlack "Hybris is up and running! Branch: ${env.BRANCH_NAME} // Commit: ${env.GIT_COMMIT}", 'pipelines'
      }
    }
  }
}
